# 样本内和样本外

到目前为止，我们都通过样本内（IS）检验来评估交易策略，也就是说，我们使用历史信息中的所有收益值进行判断。我们还可以将历史信息分为样本内区间和样本外（OOS）区间，我们可以使用OOS的检验结果评估基于IS设定的策略。

这样做会造成很多问题。首先，OOS时期通常不是真正意义上的在样本之外，因为研究人员知道该时期发生了什么。其次，在对数据进行切分时，我们可能会遇到这样的情况：因为样本内的观察值变得更少，我们可能无法找到真实的策略是什么。也就是说，某些盈利的交易策略并未进入OOS阶段。而且，因为OOS区间内的观察值也很少，一些真正有效的策略可能无法通过样本外检验，被错误地丢弃。

针对Capital IQ数据中的三种策略，如果我们将最近5年作为样本外区间，那么计算得出的样本外夏普比率分别为0.64、-0.30和0.18。可以看出，第三种策略的夏普比率很小，虽然在整个样本中比较显著（_p_值=0.11），但在样本外区间中不显著（_p_值=0.53）。其原因在于，样本外区间只有60个月的观测值，一个真正有效的策略也会有很大概率不能通过样本外检验。

洛佩斯·普拉多等人的最新研究针对样本外检验提出了“回测过拟合概率”（PBO）的概念，以衡量回测过拟合的程度（参见Bailey et al.，2013a，b；López de Prado，2013）。具体来说，PBO衡量的是在样本内表现优异的策略在样本外表现不佳的可能性有多大，它从概率的角度简洁地描述了回测过拟合的程度，在各类情况下都能有所应用。

为了理解样本内和样本外的差异，我们再次以图22-2中200个策略的收益为例。一种进行样本外检验的方法是将样本分为两部分；我们根据样本的前半部分（即前5年）的表现评估200个策略的表现，然后再根据样本的后半部分（样本外）进一步评估。其想法是，对于样本内看似不错但实际并不正确的策略，它们可能会在样本外期间表现不佳。另一种方法是，我们可以把全部的10年信息作为样本内数据，并据此评估策略。使用洛佩斯·普拉多等人的方法，我们可以计算出PBO为0.45。18因此，在样本内表现最佳的策略在样本外的表现低于平均水平的可能性很高（有0.45的概率）。这与我们的结果一致，根据整个样本，如果我们考虑多次检验，那么最佳策略的收益是不显著的。但是，PBO评估的是一类策略，我们的方法则是针对每种策略调整夏普比率。

从本质上讲，PBO和多重检验各有千秋。成功融合这些方法可能会更有力地帮助基金经理正确评估其交易策略。